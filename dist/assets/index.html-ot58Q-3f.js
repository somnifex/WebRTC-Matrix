import{d as x,r as i,o as D,g as b,c as u,a as c,b as a,e as B,t as v,m as k,_ as L,l as A}from"./_plugin-vue_export-helper-KKkw3Lli.js";import{S as d,b as p}from"./storage-BhOQnXRe.js";import{m as E}from"./match-DBrPD0DG.js";const I={class:"popup-container"},O={key:0,class:"main-content"},U={class:"domain-info"},W={key:1},F={key:2},M={key:3,class:"error-banner"},P=x({__name:"App",setup(N){const o=i(""),s=i(!1),l=i(!0),r=i(""),m=i(null),y=async()=>{const t=await p.tabs.query({active:!0,currentWindow:!0});if(t.length>0&&t[0].url){const e=new URL(t[0].url);if(e.protocol.startsWith("http"))return e.hostname}return null},w=async()=>{l.value=!0,r.value="";try{const t=await y();if(!t){o.value="Unknown / Restricted",l.value=!1;return}o.value=t,m.value=await d.getSettings();const e=await d.getRules(),n=E(t,e);n?s.value=n==="block":s.value=m.value.defaultRule==="block"}catch(t){console.error("Failed to check status:",t),r.value=`Error: ${t instanceof Error?t.message:String(t)}`}finally{l.value=!1}},_=async()=>{if(!(!o.value||o.value.includes(" ")))try{const t=!s.value;s.value=t;const e=await d.getRules(),n=e.findIndex(S=>S.domain===o.value),f=t?"block":"allow";n>=0?(e[n].action=f,e[n].timestamp=Date.now()):e.push({id:crypto.randomUUID(),domain:o.value,action:f,timestamp:Date.now()}),await d.setRules(e)}catch(t){console.error("Failed to toggle rule:",t),r.value="Failed to save rule.",s.value=!s.value}},h=()=>{p.runtime.openOptionsPage()},C=()=>{p.tabs.reload()};D(()=>{w()});const g=b(()=>s.value?"#ff4d4f":"#52c41a"),R=b(()=>s.value?"BLOCKED":"ALLOWED");return(t,e)=>(c(),u("div",I,[e[4]||(e[4]=a("div",{class:"header"},[a("h2",null,"WebRTC Matrix")],-1)),!l.value&&o.value&&!o.value.includes(" ")?(c(),u("div",O,[a("div",U,v(o.value),1),a("div",{class:"toggle-section",onClick:_},[a("div",{class:"power-btn",style:k({backgroundColor:g.value})},[...e[0]||(e[0]=[a("span",{class:"icon"},"‚èª",-1)])],4),a("div",{class:"status-label",style:k({color:g.value})},v(R.value),5)]),e[1]||(e[1]=a("p",{class:"hint"},"Click button to toggle rule for this domain",-1))])):l.value?(c(),u("div",F,[...e[3]||(e[3]=[a("p",null,"Loading...",-1)])])):(c(),u("div",W,[...e[2]||(e[2]=[a("p",null,"System page or invalid context.",-1)])])),r.value?(c(),u("div",M,v(r.value),1)):B("",!0),a("div",{class:"footer"},[a("button",{onClick:h},"Dashboard"),a("button",{onClick:C,class:"secondary"},"Refresh Page")])]))}}),T=L(P,[["__scopeId","data-v-f07e7c82"]]);A(T).mount("#app");
