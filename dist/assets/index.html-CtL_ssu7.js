var E=Object.defineProperty;var F=(y,e,a)=>e in y?E(y,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):y[e]=a;var L=(y,e,a)=>F(y,typeof e!="symbol"?e+"":e,a);import{d as P,r as v,o as x,c as g,a as f,b as t,e as _,w,v as R,f as z,t as b,_ as B,g as O,h as C,i as W,F as G,j,n as D,k as U,l as H}from"./_plugin-vue_export-helper-KKkw3Lli.js";import{S as h,b as $}from"./storage-BhOQnXRe.js";const K={key:0,class:"settings-tab"},J={class:"card"},Y={class:"form-group"},q={class:"card"},Q={class:"form-group"},X={class:"card"},Z={class:"form-group row"},ee={key:0,class:"status-msg"},te={key:1},se=P({__name:"SettingsTab",setup(y){const e=v(null),a=v(!0),s=v("");x(async()=>{e.value=await h.getSettings(),a.value=!1});const i=async()=>{e.value&&(await h.setSettings(e.value),s.value="Saved!",setTimeout(()=>s.value="",2e3))};return(r,o)=>e.value?(f(),g("div",K,[t("div",J,[o[5]||(o[5]=t("h3",null,"Global Browser Policy (Level 2)",-1)),o[6]||(o[6]=t("p",{class:"desc"}," Configure the browser's native WebRTC IP handling policy. This acts as a fallback for domains not covered by specific rules. ",-1)),t("div",Y,[o[4]||(o[4]=t("label",null,"Policy:",-1)),w(t("select",{"onUpdate:modelValue":o[0]||(o[0]=d=>e.value.globalPolicy=d),onChange:i},[...o[3]||(o[3]=[t("option",{value:"default"},"Default (Browser Default)",-1),t("option",{value:"default_public_interface_only"},"Default Public Interface Only (Recommended)",-1),t("option",{value:"disable_non_proxied_udp"},"Disable Non-Proxied UDP (Force Proxy)",-1)])],544),[[R,e.value.globalPolicy]])])]),t("div",q,[o[9]||(o[9]=t("h3",null,"Default Rule Action (Level 1)",-1)),o[10]||(o[10]=t("p",{class:"desc"}," What should happen to domains that are NOT in your rule list? ",-1)),t("div",Q,[o[8]||(o[8]=t("label",null,"Default Action:",-1)),w(t("select",{"onUpdate:modelValue":o[1]||(o[1]=d=>e.value.defaultRule=d),onChange:i},[...o[7]||(o[7]=[t("option",{value:"allow"},"Allow by default",-1),t("option",{value:"block"},"Block by default",-1)])],544),[[R,e.value.defaultRule]])])]),t("div",X,[o[12]||(o[12]=t("h3",null,"Appearance",-1)),t("div",Z,[w(t("input",{type:"checkbox",id:"badge","onUpdate:modelValue":o[2]||(o[2]=d=>e.value.showIconBadge=d),onChange:i},null,544),[[z,e.value.showIconBadge]]),o[11]||(o[11]=t("label",{for:"badge"},"Show status badge on extension icon",-1))])]),s.value?(f(),g("div",ee,b(s.value),1)):_("",!0)])):(f(),g("div",te,"Loading..."))}}),ae=B(se,[["__scopeId","data-v-85b5df8b"]]),oe={class:"rules-tab"},ne={class:"action-bar"},le={class:"add-box"},ie=["disabled"],re=["disabled"],ue=["disabled"],ce={key:0,class:"error-msg"},de={class:"rules-list"},ve={class:"domain"},pe=["onClick"],fe={key:0,class:"empty"},me=P({__name:"RulesTab",setup(y){const e=v([]),a=v(""),s=v(""),i=v("block"),r=v(!1),o=v("");x(async()=>{e.value=await h.getRules()});const d=O(()=>a.value?e.value.filter(p=>p.domain.includes(a.value)):e.value),S=async()=>{if(s.value){r.value=!0,o.value="";try{const p=e.value.find(u=>u.domain===s.value);if(p)p.action=i.value,p.timestamp=Date.now();else{let u;try{u=crypto.randomUUID()}catch{u=Date.now().toString(36)+Math.random().toString(36).substr(2)}e.value.push({id:u,domain:s.value,action:i.value,timestamp:Date.now()})}await h.setRules(e.value),s.value=""}catch(p){console.error("Failed to add rule:",p),o.value=`Failed to save rule: ${p.message||p}`}finally{r.value=!1}}},T=async p=>{e.value=e.value.filter(u=>u.id!==p),await h.setRules(e.value)};return(p,u)=>(f(),g("div",oe,[t("div",ne,[w(t("input",{"onUpdate:modelValue":u[0]||(u[0]=n=>a.value=n),placeholder:"Search domains...",class:"search-input"},null,512),[[C,a.value]]),t("div",le,[w(t("input",{"onUpdate:modelValue":u[1]||(u[1]=n=>s.value=n),placeholder:"example.com or *.example.com",onKeyup:W(S,["enter"]),disabled:r.value},null,40,ie),[[C,s.value]]),w(t("select",{"onUpdate:modelValue":u[2]||(u[2]=n=>i.value=n),disabled:r.value},[...u[3]||(u[3]=[t("option",{value:"allow"},"Allow",-1),t("option",{value:"block"},"Block",-1)])],8,re),[[R,i.value]]),t("button",{onClick:S,disabled:r.value},b(r.value?"Adding...":"Add Rule"),9,ue)]),o.value?(f(),g("div",ce,b(o.value),1)):_("",!0)]),t("div",de,[u[4]||(u[4]=t("div",{class:"rule-header"},[t("span",null,"Domain"),t("span",null,"Action"),t("span")],-1)),(f(!0),g(G,null,j(d.value,n=>(f(),g("div",{key:n.id,class:"rule-item"},[t("span",ve,b(n.domain),1),t("span",{class:D(["action",n.action])},b(n.action.toUpperCase()),3),t("button",{class:"delete-btn",onClick:c=>T(n.id)},"×",8,pe)]))),128)),d.value.length===0?(f(),g("div",fe," No rules found. ")):_("",!0)])]))}}),ge=B(me,[["__scopeId","data-v-66a49bfc"]]),k="webrtc-matrix";class ye{constructor(e){L(this,"config");this.config=e}normalizeBaseUrl(){return this.config.url.replace(/\/+$/,"")}isBaseAlreadyAppDirectory(){const a=this.normalizeBaseUrl().split("/").filter(Boolean),s=a[a.length-1];return!!s&&s.toLowerCase()===k}normalizePath(e){return e.replace(/^\/+/,"")}buildUrl(e=""){const a=this.normalizeBaseUrl(),s=this.normalizePath(e);return s?`${a}/${s}`:a}getAuthHeader(){return this.config.username&&this.config.password?"Basic "+btoa(`${this.config.username}:${this.config.password}`):""}async fetch(e,a="",s){const i=this.buildUrl(a),r={};s&&typeof s=="string"&&(r["Content-Type"]="application/json");const o=this.getAuthHeader();o&&(r.Authorization=o);try{return await fetch(i,{method:e,headers:r,body:s})}catch(d){throw console.error("[WebDAV] Request failed",d),d}}withAppDirectory(e){const a=this.normalizePath(e);return this.isBaseAlreadyAppDirectory()?a:`${k}/${a}`}async ensureAppDirectory(){if(this.isBaseAlreadyAppDirectory())return;const e=`${k}/`;try{const s=await this.fetch("PROPFIND",e);if(s.ok||s.status===207)return}catch{}const a=await this.fetch("MKCOL",e);if(a.status!==405&&!(a.ok||a.status===201||a.status===204))throw new Error(`[WebDAV] Failed to create "${k}" directory (status ${a.status}).`)}async checkConnection(){try{const e=await this.fetch("PROPFIND","",void 0);return e.ok||e.status===207}catch{return!1}}async uploadConfig(e,a){try{await this.ensureAppDirectory();const s=this.withAppDirectory(e),i=await this.fetch("PUT",s,a);return i.ok||i.status===201||i.status===204}catch(s){throw console.error("[WebDAV] Upload failed",s),s}}async downloadConfig(e){try{const a=this.withAppDirectory(e),s=await this.fetch("GET",a);if(s.status===404&&!this.isBaseAlreadyAppDirectory()){const i=await this.fetch("GET",e);if(i.status===404)return null;if(!i.ok)throw new Error(`HTTP ${i.status}`);return await i.text()}if(s.status===404)return null;if(!s.ok)throw new Error(`HTTP ${s.status}`);return await s.text()}catch(a){throw console.error("[WebDAV] Download failed",a),a}}}const he={class:"sync-tab"},we={class:"card"},be={class:"form-group"},_e={class:"form-group"},Ce={class:"form-group"},De={class:"actions"},Se=["disabled"],$e={class:"card"},ke={class:"desc"},Ae={class:"sync-buttons"},Pe=["disabled"],Te=["disabled"],I="webrtc-matrix-config.json",A="webdav_config",Ue=P({__name:"SyncTab",setup(y){const e=v({url:"",username:"",password:""}),a=v(""),s=v("info"),i=v("Never"),r=v(!1);x(async()=>{const c=await $.storage.local.get(A);c[A]&&(e.value=c[A]);const l=await $.storage.local.get("lastSyncTime");l.lastSyncTime&&(i.value=new Date(l.lastSyncTime).toLocaleString())});const o=async()=>{await $.storage.local.set({[A]:e.value})},d=()=>new ye(e.value),S=async()=>{if(!e.value.url){n("Please enter a WebDAV URL","error");return}r.value=!0,n("Connecting...","info");try{await d().checkConnection()?(n("Connection Successful!","success"),o()):n("Connection Failed. Check URL/Auth.","error")}catch(c){n("Connection Error: "+c,"error")}finally{r.value=!1}},T=async()=>{r.value=!0,n("Uploading configuration...","info");try{const c=d(),l=await h.getRules(),m=await h.getSettings(),V=await h.getMeta(),M={rules:l,settings:m,meta:{...V,lastModified:Date.now()}},N=JSON.stringify(M,null,2);await c.uploadConfig(I,N)?(n("Upload Successful!","success"),u()):n("Upload Failed.","error")}catch(c){n("Upload Error: "+c,"error")}finally{r.value=!1}},p=async()=>{r.value=!0,n("Downloading configuration...","info");try{const l=await d().downloadConfig(I);if(!l){n("Remote configuration file not found.","error");return}let m;try{m=JSON.parse(l)}catch{n("Invalid JSON in remote file.","error");return}await h.setRules(m.rules),await h.setSettings(m.settings),n("Download & Sync Successful!","success"),u()}catch(c){n("Download Error: "+c,"error")}finally{r.value=!1}},u=async()=>{const c=Date.now();i.value=new Date(c).toLocaleString(),await $.storage.local.set({lastSyncTime:c})},n=(c,l)=>{a.value=c,s.value=l};return(c,l)=>(f(),g("div",he,[t("div",we,[l[6]||(l[6]=t("h3",null,"WebDAV Configuration",-1)),t("div",be,[l[3]||(l[3]=t("label",null,"Server URL",-1)),w(t("input",{"onUpdate:modelValue":l[0]||(l[0]=m=>e.value.url=m),type:"text",placeholder:"https://cloud.example.com/remote.php/webdav/"},null,512),[[C,e.value.url]])]),t("div",_e,[l[4]||(l[4]=t("label",null,"Username",-1)),w(t("input",{"onUpdate:modelValue":l[1]||(l[1]=m=>e.value.username=m),type:"text"},null,512),[[C,e.value.username]])]),t("div",Ce,[l[5]||(l[5]=t("label",null,"Password",-1)),w(t("input",{"onUpdate:modelValue":l[2]||(l[2]=m=>e.value.password=m),type:"password"},null,512),[[C,e.value.password]])]),t("div",De,[t("button",{onClick:S,disabled:r.value},"Test Connection",8,Se)])]),t("div",$e,[l[7]||(l[7]=t("h3",null,"Sync Actions",-1)),t("p",ke,"Last Synced: "+b(i.value),1),t("div",Ae,[t("button",{class:"primary",onClick:T,disabled:r.value}," ↑ Upload (Push) ",8,Pe),t("button",{class:"primary",onClick:p,disabled:r.value}," ↓ Download (Pull) ",8,Te)])]),a.value?(f(),g("div",{key:0,class:D(["status-bar",s.value])},b(a.value),3)):_("",!0)]))}}),Re=B(Ue,[["__scopeId","data-v-bd878c49"]]),xe={class:"options-container"},Be={class:"sidebar"},Ve={class:"content"},Le=P({__name:"App",setup(y){const e=v("settings");return(a,s)=>(f(),g("div",xe,[t("div",Be,[s[3]||(s[3]=t("div",{class:"logo"},[t("h2",null,"WebRTC Matrix")],-1)),t("nav",null,[t("div",{class:D(["nav-item",{active:e.value==="settings"}]),onClick:s[0]||(s[0]=i=>e.value="settings")}," General Settings ",2),t("div",{class:D(["nav-item",{active:e.value==="rules"}]),onClick:s[1]||(s[1]=i=>e.value="rules")}," Rule Management ",2),t("div",{class:D(["nav-item",{active:e.value==="sync"}]),onClick:s[2]||(s[2]=i=>e.value="sync")}," Cloud Sync ",2)])]),t("div",Ve,[e.value==="settings"?(f(),U(ae,{key:0})):_("",!0),e.value==="rules"?(f(),U(ge,{key:1})):_("",!0),e.value==="sync"?(f(),U(Re,{key:2})):_("",!0)])]))}});H(Le).mount("#app");
