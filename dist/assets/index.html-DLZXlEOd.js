var B=Object.defineProperty;var E=(y,t,a)=>t in y?B(y,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):y[t]=a;var N=(y,t,a)=>E(y,typeof t!="symbol"?t+"":t,a);import{d as T,r as p,o as A,c as b,a as f,b as e,e as h,w as _,v as x,f as W,t as k,_ as P,g as F,h as C,i as O,F as j,j as G,n as S,k as U,l as H}from"./_plugin-vue_export-helper-KKkw3Lli.js";import{S as g,a as D}from"./storage-BF9_fGL3.js";const J={key:0,class:"settings-tab"},K={class:"card"},z={class:"form-group"},Y={class:"card"},q={class:"form-group"},Q={class:"card"},X={class:"form-group row"},Z={key:0,class:"status-msg"},ee={key:1},te=T({__name:"SettingsTab",setup(y){const t=p(null),a=p(!0),o=p("");A(async()=>{t.value=await g.getSettings(),a.value=!1});const i=async()=>{t.value&&(await g.setSettings(t.value),o.value="Saved!",setTimeout(()=>o.value="",2e3))};return(r,s)=>t.value?(f(),b("div",J,[e("div",K,[s[5]||(s[5]=e("h3",null,"Global Browser Policy (Level 2)",-1)),s[6]||(s[6]=e("p",{class:"desc"}," Configure the browser's native WebRTC IP handling policy. This acts as a fallback for domains not covered by specific rules. ",-1)),e("div",z,[s[4]||(s[4]=e("label",null,"Policy:",-1)),_(e("select",{"onUpdate:modelValue":s[0]||(s[0]=c=>t.value.globalPolicy=c),onChange:i},[...s[3]||(s[3]=[e("option",{value:"default"},"Default (Browser Default)",-1),e("option",{value:"default_public_interface_only"},"Default Public Interface Only (Recommended)",-1),e("option",{value:"disable_non_proxied_udp"},"Disable Non-Proxied UDP (Force Proxy)",-1)])],544),[[x,t.value.globalPolicy]])])]),e("div",Y,[s[9]||(s[9]=e("h3",null,"Default Rule Action (Level 1)",-1)),s[10]||(s[10]=e("p",{class:"desc"}," What should happen to domains that are NOT in your rule list? ",-1)),e("div",q,[s[8]||(s[8]=e("label",null,"Default Action:",-1)),_(e("select",{"onUpdate:modelValue":s[1]||(s[1]=c=>t.value.defaultRule=c),onChange:i},[...s[7]||(s[7]=[e("option",{value:"allow"},"Allow by default",-1),e("option",{value:"block"},"Block by default",-1)])],544),[[x,t.value.defaultRule]])])]),e("div",Q,[s[12]||(s[12]=e("h3",null,"Appearance",-1)),e("div",X,[_(e("input",{type:"checkbox",id:"badge","onUpdate:modelValue":s[2]||(s[2]=c=>t.value.showIconBadge=c),onChange:i},null,544),[[W,t.value.showIconBadge]]),s[11]||(s[11]=e("label",{for:"badge"},"Show status badge on extension icon",-1))])]),o.value?(f(),b("div",Z,k(o.value),1)):h("",!0)])):(f(),b("div",ee,"Loading..."))}}),se=P(te,[["__scopeId","data-v-a054ccde"]]),oe={class:"rules-tab"},ae={class:"action-bar"},ne={class:"add-box"},le={class:"rules-list"},ie={class:"domain"},re=["onClick"],ue={key:0,class:"empty"},ce=T({__name:"RulesTab",setup(y){const t=p([]),a=p(""),o=p(""),i=p("block");A(async()=>{t.value=await g.getRules()});const r=F(()=>a.value?t.value.filter(w=>w.domain.includes(a.value)):t.value),s=async()=>{if(!o.value)return;const w=t.value.find(u=>u.domain===o.value);w?(w.action=i.value,w.timestamp=Date.now()):t.value.push({id:crypto.randomUUID(),domain:o.value,action:i.value,timestamp:Date.now()}),await g.setRules(t.value),o.value=""},c=async w=>{t.value=t.value.filter(u=>u.id!==w),await g.setRules(t.value)};return(w,u)=>(f(),b("div",oe,[e("div",ae,[_(e("input",{"onUpdate:modelValue":u[0]||(u[0]=v=>a.value=v),placeholder:"Search domains...",class:"search-input"},null,512),[[C,a.value]]),e("div",ne,[_(e("input",{"onUpdate:modelValue":u[1]||(u[1]=v=>o.value=v),placeholder:"example.com or *.example.com",onKeyup:O(s,["enter"])},null,544),[[C,o.value]]),_(e("select",{"onUpdate:modelValue":u[2]||(u[2]=v=>i.value=v)},[...u[3]||(u[3]=[e("option",{value:"allow"},"Allow",-1),e("option",{value:"block"},"Block",-1)])],512),[[x,i.value]]),e("button",{onClick:s},"Add Rule")])]),e("div",le,[u[4]||(u[4]=e("div",{class:"rule-header"},[e("span",null,"Domain"),e("span",null,"Action"),e("span")],-1)),(f(!0),b(j,null,G(r.value,v=>(f(),b("div",{key:v.id,class:"rule-item"},[e("span",ie,k(v.domain),1),e("span",{class:S(["action",v.action])},k(v.action.toUpperCase()),3),e("button",{class:"delete-btn",onClick:R=>c(v.id)},"×",8,re)]))),128)),r.value.length===0?(f(),b("div",ue," No rules found. ")):h("",!0)])]))}}),de=P(ce,[["__scopeId","data-v-d4403eb5"]]);class ve{constructor(t){N(this,"config");this.config=t}getAuthHeader(){return this.config.username&&this.config.password?"Basic "+btoa(`${this.config.username}:${this.config.password}`):""}async fetch(t,a="",o){const i=this.config.url.replace(/\/$/,"")+"/"+a.replace(/^\//,""),r={"Content-Type":"application/json"},s=this.getAuthHeader();s&&(r.Authorization=s);try{return await fetch(i,{method:t,headers:r,body:o})}catch(c){throw console.error("[WebDAV] Request failed",c),c}}async checkConnection(){try{const t=await this.fetch("PROPFIND","",void 0);return t.ok||t.status===207}catch{return!1}}async uploadConfig(t,a){try{const o=await this.fetch("PUT",t,a);return o.ok||o.status===201||o.status===204}catch(o){throw console.error("[WebDAV] Upload failed",o),o}}async downloadConfig(t){try{const a=await this.fetch("GET",t);if(a.status===404)return null;if(!a.ok)throw new Error(`HTTP ${a.status}`);return await a.text()}catch(a){throw console.error("[WebDAV] Download failed",a),a}}}const pe={class:"sync-tab"},fe={class:"card"},me={class:"form-group"},ge={class:"form-group"},ye={class:"form-group"},we={class:"actions"},be=["disabled"],_e={class:"card"},he={class:"desc"},Ce={class:"sync-buttons"},Se=["disabled"],ke=["disabled"],I="webrtc-matrix-config.json",$="webdav_config",De=T({__name:"SyncTab",setup(y){const t=p({url:"",username:"",password:""}),a=p(""),o=p("info"),i=p("Never"),r=p(!1);A(async()=>{const l=await D.browser.storage.local.get($);l[$]&&(t.value=l[$]);const n=await D.browser.storage.local.get("lastSyncTime");n.lastSyncTime&&(i.value=new Date(n.lastSyncTime).toLocaleString())});const s=async()=>{await D.browser.storage.local.set({[$]:t.value})},c=()=>new ve(t.value),w=async()=>{if(!t.value.url){d("Please enter a WebDAV URL","error");return}r.value=!0,d("Connecting...","info");try{await c().checkConnection()?(d("Connection Successful!","success"),s()):d("Connection Failed. Check URL/Auth.","error")}catch(l){d("Connection Error: "+l,"error")}finally{r.value=!1}},u=async()=>{r.value=!0,d("Uploading configuration...","info");try{const l=c(),n=await g.getRules(),m=await g.getSettings(),V=await g.getMeta(),M={rules:n,settings:m,meta:{...V,lastModified:Date.now()}},L=JSON.stringify(M,null,2);await l.uploadConfig(I,L)?(d("Upload Successful!","success"),R()):d("Upload Failed.","error")}catch(l){d("Upload Error: "+l,"error")}finally{r.value=!1}},v=async()=>{r.value=!0,d("Downloading configuration...","info");try{const n=await c().downloadConfig(I);if(!n){d("Remote configuration file not found.","error");return}let m;try{m=JSON.parse(n)}catch{d("Invalid JSON in remote file.","error");return}const V=await g.getMeta();await g.setRules(m.rules),await g.setSettings(m.settings),d("Download & Sync Successful!","success"),R()}catch(l){d("Download Error: "+l,"error")}finally{r.value=!1}},R=async()=>{const l=Date.now();i.value=new Date(l).toLocaleString(),await D.browser.storage.local.set({lastSyncTime:l})},d=(l,n)=>{a.value=l,o.value=n};return(l,n)=>(f(),b("div",pe,[e("div",fe,[n[6]||(n[6]=e("h3",null,"WebDAV Configuration",-1)),e("div",me,[n[3]||(n[3]=e("label",null,"Server URL",-1)),_(e("input",{"onUpdate:modelValue":n[0]||(n[0]=m=>t.value.url=m),type:"text",placeholder:"https://cloud.example.com/remote.php/webdav/"},null,512),[[C,t.value.url]])]),e("div",ge,[n[4]||(n[4]=e("label",null,"Username",-1)),_(e("input",{"onUpdate:modelValue":n[1]||(n[1]=m=>t.value.username=m),type:"text"},null,512),[[C,t.value.username]])]),e("div",ye,[n[5]||(n[5]=e("label",null,"Password",-1)),_(e("input",{"onUpdate:modelValue":n[2]||(n[2]=m=>t.value.password=m),type:"password"},null,512),[[C,t.value.password]])]),e("div",we,[e("button",{onClick:w,disabled:r.value},"Test Connection",8,be)])]),e("div",_e,[n[7]||(n[7]=e("h3",null,"Sync Actions",-1)),e("p",he,"Last Synced: "+k(i.value),1),e("div",Ce,[e("button",{class:"primary",onClick:u,disabled:r.value}," ↑ Upload (Push) ",8,Se),e("button",{class:"primary",onClick:v,disabled:r.value}," ↓ Download (Pull) ",8,ke)])]),a.value?(f(),b("div",{key:0,class:S(["status-bar",o.value])},k(a.value),3)):h("",!0)]))}}),$e=P(De,[["__scopeId","data-v-b1b9317f"]]),Te={class:"options-container"},Re={class:"sidebar"},Ue={class:"content"},xe=T({__name:"App",setup(y){const t=p("settings");return(a,o)=>(f(),b("div",Te,[e("div",Re,[o[3]||(o[3]=e("div",{class:"logo"},[e("h2",null,"WebRTC Matrix")],-1)),e("nav",null,[e("div",{class:S(["nav-item",{active:t.value==="settings"}]),onClick:o[0]||(o[0]=i=>t.value="settings")}," General Settings ",2),e("div",{class:S(["nav-item",{active:t.value==="rules"}]),onClick:o[1]||(o[1]=i=>t.value="rules")}," Rule Management ",2),e("div",{class:S(["nav-item",{active:t.value==="sync"}]),onClick:o[2]||(o[2]=i=>t.value="sync")}," Cloud Sync ",2)])]),e("div",Ue,[t.value==="settings"?(f(),U(se,{key:0})):h("",!0),t.value==="rules"?(f(),U(de,{key:1})):h("",!0),t.value==="sync"?(f(),U($e,{key:2})):h("",!0)])]))}});H(xe).mount("#app");
