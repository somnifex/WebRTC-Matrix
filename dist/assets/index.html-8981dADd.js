var B=Object.defineProperty;var E=(b,t,a)=>t in b?B(b,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):b[t]=a;var L=(b,t,a)=>E(b,typeof t!="symbol"?t+"":t,a);import{d as T,r as v,o as A,c as y,a as f,b as e,e as h,w,v as x,f as F,t as _,_ as P,g as W,h as C,i as O,F as j,j as G,n as S,k as U,l as H}from"./_plugin-vue_export-helper-KKkw3Lli.js";import{S as m,a as $}from"./storage-DyKUafBE.js";const J={key:0,class:"settings-tab"},K={class:"card"},z={class:"form-group"},Y={class:"card"},q={class:"form-group"},Q={class:"card"},X={class:"form-group row"},Z={key:0,class:"status-msg"},ee={key:1},te=T({__name:"SettingsTab",setup(b){const t=v(null),a=v(!0),o=v("");A(async()=>{t.value=await m.getSettings(),a.value=!1});const c=async()=>{t.value&&(await m.setSettings(t.value),o.value="Saved!",setTimeout(()=>o.value="",2e3))};return(r,s)=>t.value?(f(),y("div",J,[e("div",K,[s[5]||(s[5]=e("h3",null,"Global Browser Policy (Level 2)",-1)),s[6]||(s[6]=e("p",{class:"desc"}," Configure the browser's native WebRTC IP handling policy. This acts as a fallback for domains not covered by specific rules. ",-1)),e("div",z,[s[4]||(s[4]=e("label",null,"Policy:",-1)),w(e("select",{"onUpdate:modelValue":s[0]||(s[0]=d=>t.value.globalPolicy=d),onChange:c},[...s[3]||(s[3]=[e("option",{value:"default"},"Default (Browser Default)",-1),e("option",{value:"default_public_interface_only"},"Default Public Interface Only (Recommended)",-1),e("option",{value:"disable_non_proxied_udp"},"Disable Non-Proxied UDP (Force Proxy)",-1)])],544),[[x,t.value.globalPolicy]])])]),e("div",Y,[s[9]||(s[9]=e("h3",null,"Default Rule Action (Level 1)",-1)),s[10]||(s[10]=e("p",{class:"desc"}," What should happen to domains that are NOT in your rule list? ",-1)),e("div",q,[s[8]||(s[8]=e("label",null,"Default Action:",-1)),w(e("select",{"onUpdate:modelValue":s[1]||(s[1]=d=>t.value.defaultRule=d),onChange:c},[...s[7]||(s[7]=[e("option",{value:"allow"},"Allow by default",-1),e("option",{value:"block"},"Block by default",-1)])],544),[[x,t.value.defaultRule]])])]),e("div",Q,[s[12]||(s[12]=e("h3",null,"Appearance",-1)),e("div",X,[w(e("input",{type:"checkbox",id:"badge","onUpdate:modelValue":s[2]||(s[2]=d=>t.value.showIconBadge=d),onChange:c},null,544),[[F,t.value.showIconBadge]]),s[11]||(s[11]=e("label",{for:"badge"},"Show status badge on extension icon",-1))])]),o.value?(f(),y("div",Z,_(o.value),1)):h("",!0)])):(f(),y("div",ee,"Loading..."))}}),se=P(te,[["__scopeId","data-v-a054ccde"]]),oe={class:"rules-tab"},ae={class:"action-bar"},ne={class:"add-box"},le=["disabled"],ie=["disabled"],re=["disabled"],ue={key:0,class:"error-msg"},ce={class:"rules-list"},de={class:"domain"},ve=["onClick"],pe={key:0,class:"empty"},fe=T({__name:"RulesTab",setup(b){const t=v([]),a=v(""),o=v(""),c=v("block"),r=v(!1),s=v("");A(async()=>{t.value=await m.getRules()});const d=W(()=>a.value?t.value.filter(p=>p.domain.includes(a.value)):t.value),k=async()=>{if(o.value){r.value=!0,s.value="";try{const p=t.value.find(i=>i.domain===o.value);if(p)p.action=c.value,p.timestamp=Date.now();else{let i;try{i=crypto.randomUUID()}catch{i=Date.now().toString(36)+Math.random().toString(36).substr(2)}t.value.push({id:i,domain:o.value,action:c.value,timestamp:Date.now()})}await m.setRules(t.value),o.value=""}catch(p){console.error("Failed to add rule:",p),s.value=`Failed to save rule: ${p.message||p}`}finally{r.value=!1}}},R=async p=>{t.value=t.value.filter(i=>i.id!==p),await m.setRules(t.value)};return(p,i)=>(f(),y("div",oe,[e("div",ae,[w(e("input",{"onUpdate:modelValue":i[0]||(i[0]=n=>a.value=n),placeholder:"Search domains...",class:"search-input"},null,512),[[C,a.value]]),e("div",ne,[w(e("input",{"onUpdate:modelValue":i[1]||(i[1]=n=>o.value=n),placeholder:"example.com or *.example.com",onKeyup:O(k,["enter"]),disabled:r.value},null,40,le),[[C,o.value]]),w(e("select",{"onUpdate:modelValue":i[2]||(i[2]=n=>c.value=n),disabled:r.value},[...i[3]||(i[3]=[e("option",{value:"allow"},"Allow",-1),e("option",{value:"block"},"Block",-1)])],8,ie),[[x,c.value]]),e("button",{onClick:k,disabled:r.value},_(r.value?"Adding...":"Add Rule"),9,re)]),s.value?(f(),y("div",ue,_(s.value),1)):h("",!0)]),e("div",ce,[i[4]||(i[4]=e("div",{class:"rule-header"},[e("span",null,"Domain"),e("span",null,"Action"),e("span")],-1)),(f(!0),y(j,null,G(d.value,n=>(f(),y("div",{key:n.id,class:"rule-item"},[e("span",de,_(n.domain),1),e("span",{class:S(["action",n.action])},_(n.action.toUpperCase()),3),e("button",{class:"delete-btn",onClick:u=>R(n.id)},"×",8,ve)]))),128)),d.value.length===0?(f(),y("div",pe," No rules found. ")):h("",!0)])]))}}),ge=P(fe,[["__scopeId","data-v-8b559634"]]);class me{constructor(t){L(this,"config");this.config=t}getAuthHeader(){return this.config.username&&this.config.password?"Basic "+btoa(`${this.config.username}:${this.config.password}`):""}async fetch(t,a="",o){const c=this.config.url.replace(/\/$/,"")+"/"+a.replace(/^\//,""),r={"Content-Type":"application/json"},s=this.getAuthHeader();s&&(r.Authorization=s);try{return await fetch(c,{method:t,headers:r,body:o})}catch(d){throw console.error("[WebDAV] Request failed",d),d}}async checkConnection(){try{const t=await this.fetch("PROPFIND","",void 0);return t.ok||t.status===207}catch{return!1}}async uploadConfig(t,a){try{const o=await this.fetch("PUT",t,a);return o.ok||o.status===201||o.status===204}catch(o){throw console.error("[WebDAV] Upload failed",o),o}}async downloadConfig(t){try{const a=await this.fetch("GET",t);if(a.status===404)return null;if(!a.ok)throw new Error(`HTTP ${a.status}`);return await a.text()}catch(a){throw console.error("[WebDAV] Download failed",a),a}}}const ye={class:"sync-tab"},be={class:"card"},we={class:"form-group"},_e={class:"form-group"},he={class:"form-group"},Ce={class:"actions"},Se=["disabled"],ke={class:"card"},$e={class:"desc"},De={class:"sync-buttons"},Te=["disabled"],Re=["disabled"],N="webrtc-matrix-config.json",D="webdav_config",Ue=T({__name:"SyncTab",setup(b){const t=v({url:"",username:"",password:""}),a=v(""),o=v("info"),c=v("Never"),r=v(!1);A(async()=>{const u=await $.browser.storage.local.get(D);u[D]&&(t.value=u[D]);const l=await $.browser.storage.local.get("lastSyncTime");l.lastSyncTime&&(c.value=new Date(l.lastSyncTime).toLocaleString())});const s=async()=>{await $.browser.storage.local.set({[D]:t.value})},d=()=>new me(t.value),k=async()=>{if(!t.value.url){n("Please enter a WebDAV URL","error");return}r.value=!0,n("Connecting...","info");try{await d().checkConnection()?(n("Connection Successful!","success"),s()):n("Connection Failed. Check URL/Auth.","error")}catch(u){n("Connection Error: "+u,"error")}finally{r.value=!1}},R=async()=>{r.value=!0,n("Uploading configuration...","info");try{const u=d(),l=await m.getRules(),g=await m.getSettings(),V=await m.getMeta(),M={rules:l,settings:g,meta:{...V,lastModified:Date.now()}},I=JSON.stringify(M,null,2);await u.uploadConfig(N,I)?(n("Upload Successful!","success"),i()):n("Upload Failed.","error")}catch(u){n("Upload Error: "+u,"error")}finally{r.value=!1}},p=async()=>{r.value=!0,n("Downloading configuration...","info");try{const l=await d().downloadConfig(N);if(!l){n("Remote configuration file not found.","error");return}let g;try{g=JSON.parse(l)}catch{n("Invalid JSON in remote file.","error");return}const V=await m.getMeta();await m.setRules(g.rules),await m.setSettings(g.settings),n("Download & Sync Successful!","success"),i()}catch(u){n("Download Error: "+u,"error")}finally{r.value=!1}},i=async()=>{const u=Date.now();c.value=new Date(u).toLocaleString(),await $.browser.storage.local.set({lastSyncTime:u})},n=(u,l)=>{a.value=u,o.value=l};return(u,l)=>(f(),y("div",ye,[e("div",be,[l[6]||(l[6]=e("h3",null,"WebDAV Configuration",-1)),e("div",we,[l[3]||(l[3]=e("label",null,"Server URL",-1)),w(e("input",{"onUpdate:modelValue":l[0]||(l[0]=g=>t.value.url=g),type:"text",placeholder:"https://cloud.example.com/remote.php/webdav/"},null,512),[[C,t.value.url]])]),e("div",_e,[l[4]||(l[4]=e("label",null,"Username",-1)),w(e("input",{"onUpdate:modelValue":l[1]||(l[1]=g=>t.value.username=g),type:"text"},null,512),[[C,t.value.username]])]),e("div",he,[l[5]||(l[5]=e("label",null,"Password",-1)),w(e("input",{"onUpdate:modelValue":l[2]||(l[2]=g=>t.value.password=g),type:"password"},null,512),[[C,t.value.password]])]),e("div",Ce,[e("button",{onClick:k,disabled:r.value},"Test Connection",8,Se)])]),e("div",ke,[l[7]||(l[7]=e("h3",null,"Sync Actions",-1)),e("p",$e,"Last Synced: "+_(c.value),1),e("div",De,[e("button",{class:"primary",onClick:R,disabled:r.value}," ↑ Upload (Push) ",8,Te),e("button",{class:"primary",onClick:p,disabled:r.value}," ↓ Download (Pull) ",8,Re)])]),a.value?(f(),y("div",{key:0,class:S(["status-bar",o.value])},_(a.value),3)):h("",!0)]))}}),xe=P(Ue,[["__scopeId","data-v-b1b9317f"]]),Ae={class:"options-container"},Pe={class:"sidebar"},Ve={class:"content"},Me=T({__name:"App",setup(b){const t=v("settings");return(a,o)=>(f(),y("div",Ae,[e("div",Pe,[o[3]||(o[3]=e("div",{class:"logo"},[e("h2",null,"WebRTC Matrix")],-1)),e("nav",null,[e("div",{class:S(["nav-item",{active:t.value==="settings"}]),onClick:o[0]||(o[0]=c=>t.value="settings")}," General Settings ",2),e("div",{class:S(["nav-item",{active:t.value==="rules"}]),onClick:o[1]||(o[1]=c=>t.value="rules")}," Rule Management ",2),e("div",{class:S(["nav-item",{active:t.value==="sync"}]),onClick:o[2]||(o[2]=c=>t.value="sync")}," Cloud Sync ",2)])]),e("div",Ve,[t.value==="settings"?(f(),U(se,{key:0})):h("",!0),t.value==="rules"?(f(),U(ge,{key:1})):h("",!0),t.value==="sync"?(f(),U(xe,{key:2})):h("",!0)])]))}});H(Me).mount("#app");
