var B=Object.defineProperty;var F=(y,t,o)=>t in y?B(y,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):y[t]=o;var L=(y,t,o)=>F(y,typeof t!="symbol"?t+"":t,o);import{d as T,r as v,o as x,c as m,a as f,b as e,e as h,w,v as A,f as E,t as _,_ as P,g as W,h as C,i as O,F as j,j as G,n as S,k as U,l as H}from"./_plugin-vue_export-helper-KKkw3Lli.js";import{S as b,b as $}from"./storage-BhOQnXRe.js";const J={key:0,class:"settings-tab"},K={class:"card"},z={class:"form-group"},Y={class:"card"},q={class:"form-group"},Q={class:"card"},X={class:"form-group row"},Z={key:0,class:"status-msg"},ee={key:1},te=T({__name:"SettingsTab",setup(y){const t=v(null),o=v(!0),a=v("");x(async()=>{t.value=await b.getSettings(),o.value=!1});const c=async()=>{t.value&&(await b.setSettings(t.value),a.value="Saved!",setTimeout(()=>a.value="",2e3))};return(u,s)=>t.value?(f(),m("div",J,[e("div",K,[s[5]||(s[5]=e("h3",null,"Global Browser Policy (Level 2)",-1)),s[6]||(s[6]=e("p",{class:"desc"}," Configure the browser's native WebRTC IP handling policy. This acts as a fallback for domains not covered by specific rules. ",-1)),e("div",z,[s[4]||(s[4]=e("label",null,"Policy:",-1)),w(e("select",{"onUpdate:modelValue":s[0]||(s[0]=d=>t.value.globalPolicy=d),onChange:c},[...s[3]||(s[3]=[e("option",{value:"default"},"Default (Browser Default)",-1),e("option",{value:"default_public_interface_only"},"Default Public Interface Only (Recommended)",-1),e("option",{value:"disable_non_proxied_udp"},"Disable Non-Proxied UDP (Force Proxy)",-1)])],544),[[A,t.value.globalPolicy]])])]),e("div",Y,[s[9]||(s[9]=e("h3",null,"Default Rule Action (Level 1)",-1)),s[10]||(s[10]=e("p",{class:"desc"}," What should happen to domains that are NOT in your rule list? ",-1)),e("div",q,[s[8]||(s[8]=e("label",null,"Default Action:",-1)),w(e("select",{"onUpdate:modelValue":s[1]||(s[1]=d=>t.value.defaultRule=d),onChange:c},[...s[7]||(s[7]=[e("option",{value:"allow"},"Allow by default",-1),e("option",{value:"block"},"Block by default",-1)])],544),[[A,t.value.defaultRule]])])]),e("div",Q,[s[12]||(s[12]=e("h3",null,"Appearance",-1)),e("div",X,[w(e("input",{type:"checkbox",id:"badge","onUpdate:modelValue":s[2]||(s[2]=d=>t.value.showIconBadge=d),onChange:c},null,544),[[E,t.value.showIconBadge]]),s[11]||(s[11]=e("label",{for:"badge"},"Show status badge on extension icon",-1))])]),a.value?(f(),m("div",Z,_(a.value),1)):h("",!0)])):(f(),m("div",ee,"Loading..."))}}),se=P(te,[["__scopeId","data-v-c422af16"]]),ae={class:"rules-tab"},oe={class:"action-bar"},ne={class:"add-box"},le=["disabled"],ie=["disabled"],ue=["disabled"],re={key:0,class:"error-msg"},ce={class:"rules-list"},de={class:"domain"},ve=["onClick"],pe={key:0,class:"empty"},fe=T({__name:"RulesTab",setup(y){const t=v([]),o=v(""),a=v(""),c=v("block"),u=v(!1),s=v("");x(async()=>{t.value=await b.getRules()});const d=W(()=>o.value?t.value.filter(p=>p.domain.includes(o.value)):t.value),k=async()=>{if(a.value){u.value=!0,s.value="";try{const p=t.value.find(i=>i.domain===a.value);if(p)p.action=c.value,p.timestamp=Date.now();else{let i;try{i=crypto.randomUUID()}catch{i=Date.now().toString(36)+Math.random().toString(36).substr(2)}t.value.push({id:i,domain:a.value,action:c.value,timestamp:Date.now()})}await b.setRules(t.value),a.value=""}catch(p){console.error("Failed to add rule:",p),s.value=`Failed to save rule: ${p.message||p}`}finally{u.value=!1}}},R=async p=>{t.value=t.value.filter(i=>i.id!==p),await b.setRules(t.value)};return(p,i)=>(f(),m("div",ae,[e("div",oe,[w(e("input",{"onUpdate:modelValue":i[0]||(i[0]=n=>o.value=n),placeholder:"Search domains...",class:"search-input"},null,512),[[C,o.value]]),e("div",ne,[w(e("input",{"onUpdate:modelValue":i[1]||(i[1]=n=>a.value=n),placeholder:"example.com or *.example.com",onKeyup:O(k,["enter"]),disabled:u.value},null,40,le),[[C,a.value]]),w(e("select",{"onUpdate:modelValue":i[2]||(i[2]=n=>c.value=n),disabled:u.value},[...i[3]||(i[3]=[e("option",{value:"allow"},"Allow",-1),e("option",{value:"block"},"Block",-1)])],8,ie),[[A,c.value]]),e("button",{onClick:k,disabled:u.value},_(u.value?"Adding...":"Add Rule"),9,ue)]),s.value?(f(),m("div",re,_(s.value),1)):h("",!0)]),e("div",ce,[i[4]||(i[4]=e("div",{class:"rule-header"},[e("span",null,"Domain"),e("span",null,"Action"),e("span")],-1)),(f(!0),m(j,null,G(d.value,n=>(f(),m("div",{key:n.id,class:"rule-item"},[e("span",de,_(n.domain),1),e("span",{class:S(["action",n.action])},_(n.action.toUpperCase()),3),e("button",{class:"delete-btn",onClick:r=>R(n.id)},"×",8,ve)]))),128)),d.value.length===0?(f(),m("div",pe," No rules found. ")):h("",!0)])]))}}),ge=P(fe,[["__scopeId","data-v-8b559634"]]);class me{constructor(t){L(this,"config");this.config=t}getAuthHeader(){return this.config.username&&this.config.password?"Basic "+btoa(`${this.config.username}:${this.config.password}`):""}async fetch(t,o="",a){const c=this.config.url.replace(/\/$/,"")+"/"+o.replace(/^\//,""),u={"Content-Type":"application/json"},s=this.getAuthHeader();s&&(u.Authorization=s);try{return await fetch(c,{method:t,headers:u,body:a})}catch(d){throw console.error("[WebDAV] Request failed",d),d}}async checkConnection(){try{const t=await this.fetch("PROPFIND","",void 0);return t.ok||t.status===207}catch{return!1}}async uploadConfig(t,o){try{const a=await this.fetch("PUT",t,o);return a.ok||a.status===201||a.status===204}catch(a){throw console.error("[WebDAV] Upload failed",a),a}}async downloadConfig(t){try{const o=await this.fetch("GET",t);if(o.status===404)return null;if(!o.ok)throw new Error(`HTTP ${o.status}`);return await o.text()}catch(o){throw console.error("[WebDAV] Download failed",o),o}}}const ye={class:"sync-tab"},be={class:"card"},we={class:"form-group"},_e={class:"form-group"},he={class:"form-group"},Ce={class:"actions"},Se=["disabled"],ke={class:"card"},$e={class:"desc"},De={class:"sync-buttons"},Te=["disabled"],Re=["disabled"],M="webrtc-matrix-config.json",D="webdav_config",Ue=T({__name:"SyncTab",setup(y){const t=v({url:"",username:"",password:""}),o=v(""),a=v("info"),c=v("Never"),u=v(!1);x(async()=>{const r=await $.storage.local.get(D);r[D]&&(t.value=r[D]);const l=await $.storage.local.get("lastSyncTime");l.lastSyncTime&&(c.value=new Date(l.lastSyncTime).toLocaleString())});const s=async()=>{await $.storage.local.set({[D]:t.value})},d=()=>new me(t.value),k=async()=>{if(!t.value.url){n("Please enter a WebDAV URL","error");return}u.value=!0,n("Connecting...","info");try{await d().checkConnection()?(n("Connection Successful!","success"),s()):n("Connection Failed. Check URL/Auth.","error")}catch(r){n("Connection Error: "+r,"error")}finally{u.value=!1}},R=async()=>{u.value=!0,n("Uploading configuration...","info");try{const r=d(),l=await b.getRules(),g=await b.getSettings(),V=await b.getMeta(),N={rules:l,settings:g,meta:{...V,lastModified:Date.now()}},I=JSON.stringify(N,null,2);await r.uploadConfig(M,I)?(n("Upload Successful!","success"),i()):n("Upload Failed.","error")}catch(r){n("Upload Error: "+r,"error")}finally{u.value=!1}},p=async()=>{u.value=!0,n("Downloading configuration...","info");try{const l=await d().downloadConfig(M);if(!l){n("Remote configuration file not found.","error");return}let g;try{g=JSON.parse(l)}catch{n("Invalid JSON in remote file.","error");return}await b.setRules(g.rules),await b.setSettings(g.settings),n("Download & Sync Successful!","success"),i()}catch(r){n("Download Error: "+r,"error")}finally{u.value=!1}},i=async()=>{const r=Date.now();c.value=new Date(r).toLocaleString(),await $.storage.local.set({lastSyncTime:r})},n=(r,l)=>{o.value=r,a.value=l};return(r,l)=>(f(),m("div",ye,[e("div",be,[l[6]||(l[6]=e("h3",null,"WebDAV Configuration",-1)),e("div",we,[l[3]||(l[3]=e("label",null,"Server URL",-1)),w(e("input",{"onUpdate:modelValue":l[0]||(l[0]=g=>t.value.url=g),type:"text",placeholder:"https://cloud.example.com/remote.php/webdav/"},null,512),[[C,t.value.url]])]),e("div",_e,[l[4]||(l[4]=e("label",null,"Username",-1)),w(e("input",{"onUpdate:modelValue":l[1]||(l[1]=g=>t.value.username=g),type:"text"},null,512),[[C,t.value.username]])]),e("div",he,[l[5]||(l[5]=e("label",null,"Password",-1)),w(e("input",{"onUpdate:modelValue":l[2]||(l[2]=g=>t.value.password=g),type:"password"},null,512),[[C,t.value.password]])]),e("div",Ce,[e("button",{onClick:k,disabled:u.value},"Test Connection",8,Se)])]),e("div",ke,[l[7]||(l[7]=e("h3",null,"Sync Actions",-1)),e("p",$e,"Last Synced: "+_(c.value),1),e("div",De,[e("button",{class:"primary",onClick:R,disabled:u.value}," ↑ Upload (Push) ",8,Te),e("button",{class:"primary",onClick:p,disabled:u.value}," ↓ Download (Pull) ",8,Re)])]),o.value?(f(),m("div",{key:0,class:S(["status-bar",a.value])},_(o.value),3)):h("",!0)]))}}),Ae=P(Ue,[["__scopeId","data-v-6d540e3b"]]),xe={class:"options-container"},Pe={class:"sidebar"},Ve={class:"content"},Le=T({__name:"App",setup(y){const t=v("settings");return(o,a)=>(f(),m("div",xe,[e("div",Pe,[a[3]||(a[3]=e("div",{class:"logo"},[e("h2",null,"WebRTC Matrix")],-1)),e("nav",null,[e("div",{class:S(["nav-item",{active:t.value==="settings"}]),onClick:a[0]||(a[0]=c=>t.value="settings")}," General Settings ",2),e("div",{class:S(["nav-item",{active:t.value==="rules"}]),onClick:a[1]||(a[1]=c=>t.value="rules")}," Rule Management ",2),e("div",{class:S(["nav-item",{active:t.value==="sync"}]),onClick:a[2]||(a[2]=c=>t.value="sync")}," Cloud Sync ",2)])]),e("div",Ve,[t.value==="settings"?(f(),U(se,{key:0})):h("",!0),t.value==="rules"?(f(),U(ge,{key:1})):h("",!0),t.value==="sync"?(f(),U(Ae,{key:2})):h("",!0)])]))}});H(Le).mount("#app");
